---
export const showcaseConfig = {
    backgroundColor: '#F5F5F7',
};
---

<div id="notificationStack-root">
    <div id="notificationStack-container"></div>
    <button id="notificationStack-addButton" class="notificationStack-addButton">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
        Add Notification
    </button>
</div>

<script is:inline>
    const TIMEOUT = 5000;
    const MAX_NOTIFICATIONS = 5;
    const STACKING_OVERLAP = 0.85;
    const NOTIFICATION_HEIGHT = 72;
    const GAP = 16;
    const STACK_SEPARATION = NOTIFICATION_HEIGHT * (1 - STACKING_OVERLAP);

    const NOTIFICATION_ICON_SVG = {
        success: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>`,
        error: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>`,
        info: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>`,
        warning: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86 1.83 18a2 2 0 0 0 1.79 3H20.38a2 2 0 0 0 1.79-3L13.71 3.86a2 2 0 0 0-3.42 0Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>`,
    };
    const CLOSE_ICON_SVG = `<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>`;

    const TYPE = ['success', 'error', 'info', 'warning'];

    const NOTIFICATION_MESSAGES = {
        success: [
            { title: 'Message Sent', content: 'Your message was delivered' },
            { title: 'Saved', content: 'Changes saved successfully' },
            { title: 'Uploaded', content: 'File uploaded to the cloud' }
        ],
        error: [
            { title: 'Connection Lost', content: 'Check your internet connection' },
            { title: 'Failed to Save', content: 'Please try again' },
            { title: 'Invalid File', content: 'File format not supported' }
        ],
        info: [
            { title: 'Update Available', content: 'A new version is ready' },
            { title: 'Reminder', content: 'Meeting starts in 10 minutes' },
            { title: 'Tip', content: 'Press âŒ˜K to open search' }
        ],
        warning: [
            { title: 'Low Storage', content: 'Only 2GB remaining' },
            { title: 'Battery Low', content: 'Connect to power source' },
            { title: 'Unsaved Changes', content: 'Remember to save your work' }
        ]
    };

    let notifications = [];
    let timeouts = new Map();
    let pausedTime = null;
    let isHovered = false;

    const $container = document.getElementById('notificationStack-container');
    const $addButton = document.getElementById('notificationStack-addButton');

    const randomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    const generateId = () => Date.now().toString(36) + Math.random().toString(36).substring(2, 7);

    const removeNotification = (id) => {
        const index = notifications.findIndex(n => n.id === id);
        if (index === -1) return;

        clearTimeout(timeouts.get(id));
        timeouts.delete(id);

        const $el = document.getElementById(`notificationStack-item-${id}`);
        if ($el) {
            $el.style.transition = 'transform 0.3s ease-out, opacity 0.3s ease-out';
            $el.classList.add('notificationStack-exit');
            
            setTimeout(() => {
                $el.remove();
                notifications = notifications.filter(n => n.id !== id);
                renderNotifications(); 
            }, 300);
        } else {
            notifications = notifications.filter(n => n.id !== id);
            renderNotifications();
        }
    };

    const startTimer = (notification) => {
        const remainingTime = notification.timeout - Date.now();
        if (remainingTime > 0) {
            const timer = setTimeout(() => {
                removeNotification(notification.id);
            }, remainingTime);
            timeouts.set(notification.id, timer);
        } else {
            removeNotification(notification.id);
        }
    };

    const renderNotifications = () => {
        notifications.forEach((notification, index) => {
            let $el = document.getElementById(`notificationStack-item-${notification.id}`);
            
            const scale = isHovered ? 1 : 1 - index * 0.06;
            const opacity = isHovered ? 1 : Math.max(0.85, 1 - (index / notifications.length) * 0.12);
            
            const y = isHovered
                ? index * (NOTIFICATION_HEIGHT + GAP)
                : index * STACK_SEPARATION;
            
            const translateY = y * -1;

            const inverseIndex = notifications.length - index - 1;
            const bgOpacity = isHovered ? 45 : Math.max(30, 50 - inverseIndex * 6);

            const shadowIntensity = isHovered ? 0.15 : 0.15 + (index * 0.05);
            const shadowBlur = isHovered ? 8 : 8 + (index * 2);
            
            if (!$el) {
                $el = document.createElement('div');
                $el.id = `notificationStack-item-${notification.id}`;
                $el.className = 'notificationStack-item notificationStack-enter';

                $el.innerHTML = `
                    <div class="notificationStack-inner" 
                        style="
                            background-color: rgba(255, 255, 255, ${bgOpacity / 100}); 
                            opacity: ${opacity};
                            box-shadow: 0 ${shadowBlur}px ${shadowBlur * 2}px rgba(0, 0, 0, ${shadowIntensity});
                        ">
                        <div class="notificationStack-icon ${notification.type}">
                            ${NOTIFICATION_ICON_SVG[notification.type]}
                        </div>
                        <div class="notificationStack-content">
                            <h2>${notification.title}</h2>
                            <p>${notification.content}</p>
                        </div>
                        <button class="notificationStack-close" data-id="${notification.id}">
                            ${CLOSE_ICON_SVG}
                        </button>
                    </div>
                `;
                
                $el.querySelector('.notificationStack-close').addEventListener('click', (e) => {
                    const id = e.currentTarget.getAttribute('data-id');
                    removeNotification(id);
                });

                $container.appendChild($el);
                void $el.offsetWidth;
                
                requestAnimationFrame(() => {
                    $el.classList.remove('notificationStack-enter');
                    $el.classList.add('notificationStack-enter-active');
                });
            }
            
            $el.style.transform = `translate(-50%, ${translateY}px) scale(${scale})`;
            
            const $inner = $el.querySelector('.notificationStack-inner');
            $inner.style.backgroundColor = `rgba(255, 255, 255, ${bgOpacity / 100})`;
            $inner.style.opacity = opacity;
            $inner.style.boxShadow = `0 ${shadowBlur}px ${shadowBlur * 2}px rgba(0, 0, 0, ${shadowIntensity})`;
        });
    };

    const addNotification = (type) => {
        const messages = NOTIFICATION_MESSAGES[type];
        const message = messages[randomInt(0, messages.length - 1)];
        
        const newNotification = { 
            id: generateId(), 
            type, 
            title: message.title, 
            content: message.content, 
            timeout: Date.now() + TIMEOUT 
        };
        
        if (notifications.length >= MAX_NOTIFICATIONS) {
            removeNotification(notifications[notifications.length - 1].id);
        }

        notifications.unshift(newNotification);
        startTimer(newNotification);
        renderNotifications();
    };

    const pauseNotifications = () => {
        if (isHovered) return;
        isHovered = true;
        pausedTime = Date.now();
        
        timeouts.forEach(clearTimeout);
        timeouts.clear();

        renderNotifications(); 
    };

    const resumeNotifications = () => {
        if (!isHovered) return;
        isHovered = false;
        
        const timeElapsed = Date.now() - pausedTime;
        pausedTime = null;

        notifications.forEach(n => {
            n.timeout += timeElapsed;
            startTimer(n);
        });

        renderNotifications(); 
    };

    $addButton.addEventListener('click', () => {
        const type = TYPE[randomInt(0, TYPE.length - 1)];
        addNotification(type);
    });

    $container.addEventListener('mouseenter', pauseNotifications);
    $container.addEventListener('mouseleave', resumeNotifications);

</script>

<style is:global>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap');

    .notificationStack-icon.success { background-color: #10b981; }
    .notificationStack-icon.error { background-color: #f87171; }
    .notificationStack-icon.info { background-color: #60a5fa; }
    .notificationStack-icon.warning { background-color: #f59e0b; }

    #notificationStack-root {
        width: 100%;
        height: 380px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
        font-family: 'Montserrat', sans-serif;
        padding-bottom: 3rem;
    }

    .notificationStack-addButton {
        background-color: #0284c7;
        color: white;
        border: none;
        border-radius: 2rem;
        padding: 0.8rem 1.2rem 0.8rem 0.8rem;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease-out;
        font-size: 1.1rem;
        font-weight: 600;
        gap: 0.5rem;
        z-index: 1;
    }

    .notificationStack-addButton:hover {
        background-color: #0ea5e9;
        transform: translateY(-2px);
    }

    .notificationStack-addButton svg { 
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); 
    }

    .notificationStack-addButton:hover svg { 
        transform: rotate(90deg); 
    }

    #notificationStack-container {
        bottom: 1rem;
        left: 50%;
        transform: translateX(-50%);
        pointer-events: none;
        z-index: 10;
        position: absolute; 
        width: 20rem; 
        height: 100%; 
        max-height: 350px;
    }

    .notificationStack-item {
        display: flex;
        pointer-events: auto;
        position: absolute; 
        width: 100%; 
        bottom: 0; 
        left: 50%;
        transform-origin: bottom center;
        transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), 
                    opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .notificationStack-item.notificationStack-enter {
        transform: translate(-50%, 220%) scale(0.7);
        opacity: 0;
    }

    .notificationStack-item.notificationStack-exit {
        transform: translate(-50%, 100%) scale(0.85) !important;
        opacity: 0 !important;
        transition: transform 0.3s ease-out, opacity 0.3s ease-out !important;
    }

    .notificationStack-inner {
        backdrop-filter: blur(12px);
        padding: 0 1rem;
        border-radius: 0.75rem;
        width: 100%; 
        height: 4.5rem; 
        display: flex;
        align-items: center;
        position: relative;
        margin-bottom: 1rem;
        transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .notificationStack-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 0.5rem;
        margin-right: 1rem;
        flex-shrink: 0;
        color: white;
    }

    .notificationStack-content {
        flex: 1;
        min-width: 0;
    }

    .notificationStack-inner h2 {
        font-weight: 700;
        font-size: 0.95rem;
        color: #1f2937;
        margin: 0;
    }

    .notificationStack-inner p {
        margin-top: 0.3rem;
        font-size: 0.8rem;
        color: #6b7280;
        margin-bottom: 0;
    }

    .notificationStack-close {
        background: none;
        border: none;
        position: absolute;
        right: 0.5rem;
        top: 0.5rem;
        cursor: pointer;
        padding: 0.25rem;
        color: #9ca3af;
        transition: all 0.2s ease;
        border-radius: 0.25rem;
    }

    .notificationStack-close:hover {
        color: #1f2937;
        background-color: rgba(0, 0, 0, 0.05);
        transform: scale(1.1);
    }

    @media (max-width: 640px) {
        #notificationStack-root {
            height: 350px;
        }
        
        .notificationStack-inner {
            width: calc(100vw - 4rem);
            max-width: 20rem;
        }
        
        #notificationStack-container {
            width: calc(100vw - 4rem);
            max-width: 20rem;
        }
    }
</style>